{% extends "index.html" %}

{% block title %}Ficha de {{ hospede['nome'] }}{% endblock %}

{% block content %}
<div class="ficha-container">
  <div class="ficha-header">
    <div class="foto-hospede">
       <img id="previewFoto" 
           src="{% if hospede and hospede.get('foto_url') %}{{ url_for('static', filename=hospede['foto_url']) }}{% else %}{{ url_for('static', filename='img/placeholder.png') }}{% endif %}" 
           alt="Foto do hóspede">

      <!-- Adicionamos name="uploadFoto" -->
     
    </div>

    <div class="dados-header">
      <h2>{{ hospede['nome'] }}</h2>
      <p><strong>Idade:</strong> <span id="idade"></span></p>
      <p><strong>Condição:</strong> {{ hospede['condicao']|capitalize }}</p>
      <p><strong>Data de Ingresso:</strong> {{ hospede['data_ingresso'] }}</p>
    </div>
  </div>


  <!-- Formulário com scroll interno -->
  <div class="ficha-scroll">
    <form class="ficha-form" action="{{ url_for('editar_hosp_alcina', hospede_id=hospede['id']) }}" method="POST" enctype="multipart/form-data">

         <input type="file" id="uploadFoto" name="uploadFoto" accept="image/*" onchange="previewImage(event)">
  <h3>Dados Pessoais</h3>

  <div class="grupo">
    <label>Número de Cadastro:</label>
    <input type="text" name="numero_cadastro" value="{{ hospede.get('numero_cadastro', '') }}">
  </div>

  <div class="grupo">
  <label>Data de Ingresso:</label>
  <input type="date" name="data_ingresso" value="{{ hospede['data_ingresso'] }}">
</div>


  <div class="grupo">
    <label>Nome:</label>
    <input type="text" name="nome" value="{{ hospede['nome'] }}">
  </div>

  <div class="grupo">
    <label>CPF:</label>
    <input type="text" name="cpf" value="{{ hospede.get('cpf','') }}">
    <label>RG:</label>
    <input type="text" name="rg" value="{{ hospede.get('rg','') }}">
  </div>

      <div class="grupo">
        <label>Data de Nascimento:</label>
        <input type="date" id="nascimento" name="nascimento" value="{{ hospede['nascimento'] }}">
        <label>Estado Civil:</label>
        <input type="text" name="estado_civil" value="{{ hospede['estado_civil'] }}">
      </div>

      <div class="grupo">
        <label>Profissão:</label>
        <input type="text" name="profissao" value="{{ hospede['profissao'] }}">
        <label>Grau de Dependência:</label>
        <input type="text" name="grau_dependencia" value="{{ hospede['grau_dependencia'] }}">
      </div>

      <h3>Endereço</h3>
      <div class="grupo">
        <label>CEP:</label>
        <input type="text" name="cep" value="{{ hospede['cep'] }}">
        <label>UF:</label>
        <input type="text" name="uf" value="{{ hospede['uf'] }}">
      </div>

      <label>Endereço:</label>
      <input type="text" name="endereco" value="{{ hospede['endereco'] }}">

      <h3>Informações Adicionais</h3>
      <div class="grupo">
        <label>Tamanho da Fralda:</label>
        <input type="text" name="tamanho_fralda" value="{{ hospede['tamanho_fralda'] }}">
        <label>Possui Bens:</label>
        <input type="text" name="possui_bens" value="{{ hospede['possui_bens'] }}">
      </div>

      <div class="grupo">
        <label>Possui Filhos:</label>
        <select name="possui_filhos" id="possui_filhos" onchange="toggleFilhos()">
          <option value="sim" {% if hospede['possui_filhos'] == 'sim' %}selected{% endif %}>Sim</option>
          <option value="não" {% if hospede['possui_filhos'] == 'não' %}selected{% endif %}>Não</option>
        </select>

        <div id="quantos_filhos_div" style="display: {% if hospede['possui_filhos'] == 'sim' %}block{% else %}none{% endif %};">
          <label>Quantos filhos:</label>
          <input type="number" name="quantos_filhos" value="{{ hospede.get('quantos_filhos',0) }}">
        </div>
      </div>

      <div class="grupo">
        <label>Pais vivos:</label>
        <select name="pais_vivos">
          <option value="sim" {% if hospede.get('pais_vivos') == 'sim' %}selected{% endif %}>Sim</option>
          <option value="não" {% if hospede.get('pais_vivos') == 'não' %}selected{% endif %}>Não</option>
        </select>
      </div>

      <h3>Contatos de Referência</h3>
      {% for i in range(1,4) %}
      <div class="grupo">
        <label>Referência {{ i }}:</label>
        <input type="text" name="referencia{{ i }}" value="{{ hospede['referencia' + i|string] }}">
        <label>Número {{ i }}:</label>
        <input type="text" name="numero{{ i }}" value="{{ hospede['numero' + i|string] }}">
      </div>
      {% endfor %}

      <h3>Informações Médicas</h3>
      <label>Diagnóstico:</label>
      <textarea name="diagnostico">{{ hospede['diagnostico'] }}</textarea>

      <label>Histórico:</label>
      <textarea name="historico">{{ hospede['historico'] }}</textarea>

      <label>Condição:</label> 
      <select name="condicao"> 
        <option value="normal" {% if hospede['condicao'] == 'normal' %}selected{% endif %}>Normal</option> 
        <option value="acamado" {% if hospede['condicao'] == 'acamado' %}selected{% endif %}>Acamado</option> 
        <option value="especial" {% if hospede['condicao'] == 'especial' %}selected{% endif %}>Sonda</option> 
      </select>

      <button type="submit" class="btn-salvar">Salvar Alterações</button>
    </form>

    <form class="form-excluir" action="{{ url_for('excluir_hosp_alcina', hospede_id=hospede['id']) }}" method="POST" onsubmit="return confirm('Tem certeza que quer excluir este hóspede?');">
      <button type="submit" class="btn-excluir">Excluir Hóspede</button>
    </form>
  </div>
</div>

<script>
function calcularIdade() {
  const nasc = document.getElementById('nascimento').value;
  if (!nasc) return;
  const hoje = new Date();
  const nascimento = new Date(nasc);
  let idade = hoje.getFullYear() - nascimento.getFullYear();
  const m = hoje.getMonth() - nascimento.getMonth();
  if (m < 0 || (m === 0 && hoje.getDate() < nascimento.getDate())) idade--;
  document.getElementById('idade').innerText = idade + " anos";
}

function previewImage(event) {
  const reader = new FileReader();
  reader.onload = function() {
    const preview = document.getElementById('previewFoto');
    preview.src = reader.result;
  };
  reader.readAsDataURL(event.target.files[0]);
}

function toggleFilhos() {
  var select = document.getElementById('possui_filhos');
  var div = document.getElementById('quantos_filhos_div');
  div.style.display = (select.value === 'sim') ? 'block' : 'none';
}

window.onload = calcularIdade;
</script>

<style>
.ficha-container {
  background: 
#f5e9ed;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  width: 90%;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  height: 80vh;
}

.ficha-scroll {
  overflow-y: auto;
  padding-right: 10px;
  scrollbar-width: thin;
  scrollbar-color: 
#89ba90 #f1f1f1;
}

.ficha-scroll::-webkit-scrollbar {
  width: 8px;
}
.ficha-scroll::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}
.ficha-scroll::-webkit-scrollbar-thumb {
  background: 
#89ba90;
  border-radius: 10px;
}

.ficha-header {
  display: flex;
  gap: 20px;
  align-items: center;
  margin-bottom: 15px;
}

.foto-hospede img {
  width: 120px;
  height: 120px;
  object-fit: cover;
  border-radius: 10px;
  border: 2px solid 
#89ba90;
}

.ficha-form {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.grupo {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}

input, select, textarea {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  width: 100%;
}

.btn-salvar {
  background: 
#89ba90;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 10px;
  cursor: pointer;
  transition: 0.3s;
}

.btn-salvar:hover {
  background: #720f29;
}

.btn-excluir {
  background: #ff0000;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 10px;
  cursor: pointer;
  transition: 0.3s;
}

.btn-excluir:hover {
  background: #c0392b;
}
</style>

{% endblock %}
